!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.okinawa=t():e.okinawa=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Background:()=>gt,Clock:()=>W,Core:()=>m,Device:()=>A,Effects:()=>j,Emitter:()=>ct,Fonts:()=>G,GUI:()=>i,INPUT:()=>n,Item:()=>x,Localization:()=>Y,Logs:()=>qe,MATH:()=>r,Options:()=>s,Particles:()=>L,Player:()=>Ue,Preloader:()=>Ke,Scene:()=>Re,Sounds:()=>B,Sprites:()=>M,engine:()=>Ve,init:()=>mt});var n={};e.r(n),e.d(n,{COMBO_TYPES:()=>v,Controller:()=>y,KEYS:()=>d,Receiver:()=>h});var i={};e.r(i),e.d(i,{ALIGN:()=>we,EVENTS:()=>Ae,GuiConsole:()=>me,GuiElement:()=>ne,GuiText:()=>ue,ORDENATION:()=>be});var r={};function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}e.r(r),e.d(r,{Point:()=>l,Rotation:()=>k,angleToDirectionVector:()=>Qe,pointDistance:()=>Ye});var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.useAnimationFrame=!1,this.useSmoothParticles=!1,this.drawBoundingBoxes=!1,this.drawMaxRadius=!1,this.drawCollisionRadius=!1,this.drawOrigins=!1,this.drawCenters=!1,this.drawTrackers=!1,this.drawDirectionVectors=!1,this.showFps=!1,this.showStatistics=!1,this.showResizeMessage=!0,this.outputPressedKeys=!1,this.outputPressedCombos=!1,this.outputClicks=!1,this.debugInConsole=!1,this.debugInHtml=!1,this.debugFunctionNames=!1,this.allowPause=!0,this.allowHalt=!1,this.allowFForFps=!0,this.pauseOnWindowChange=!1,this.avoidLeavingPage=!1,this.preventDefaultKeyStrokes=!0,this.useLanguageScreen=!1,this.defaultLanguage="english",this.assetsURLPrefix=null}var t,n;return t=e,(n=[{key:"addOptions",value:function(e){for(var t in e)this[t]=e[t]}}])&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=void 0===t?0:t,this.y=void 0===n?0:n}var t,n;return t=e,(n=[{key:"magnitude",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"normalize",value:function(){var t=this.magnitude();return new e(this.x/t,this.y/t)}},{key:"equals",value:function(t){return t instanceof e!=0&&this.x==t.x&&this.y==t.y}}])&&a(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function u(){var e="";return window.location.href?window.location.href:("file:"!=window.location.protocol&&(e+=window.location.protocol+"//"),""!==window.location.host&&(e+=window.location.host+"/"),e)}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.inverseKeyboard={},this.pressed={},this.lastPressed=[],this.lastPressedTime=(new Date).getTime(),this.currentInputController=null}var t,n;return t=e,(n=[{key:"initialize",value:function(){for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(this.inverseKeyboard[d[e]]=e);c("keyup",document,(function(e){Ve.input.onKeyup(e)})),c("keydown",document,(function(e){Ve.input.onKeydown(e),Ve.input.isTargetInput(e)||!0!==Ve.options.preventDefaultKeyStrokes&&8!=e.keyCode&&46!=e.keyCode||e.preventDefault()})),c("blur",window,(function(){Ve.input.resetKeys(),Ve.options.pauseOnWindowChange&&Ve.pauseGame()})),c("touchstart",Ve.core.canvas,(function(e){return Ve.input.onClickStart(e.touches[0].clientX,e.touches[0].clientY),navigator.userAgent.match(/Android/i)&&e.preventDefault(),!1})),c("touchmove",Ve.core.canvas,(function(e){return e.preventDefault(),!1})),c("touchend",Ve.core.canvas,(function(e){return e.preventDefault(),!1})),c("click",Ve.core.canvas,(function(e){return Ve.input.onClickStart(e.clientX,e.clientY),e.preventDefault(),!1})),c("mousedown",Ve.core.canvas,(function(e){return e.preventDefault(),!1}))}},{key:"activate",value:function(){}},{key:"getCurrentInputcontroller",value:function(){return this.currentInputController}},{key:"setCurrentInputController",value:function(e){this.currentInputController=e}},{key:"isKeyPressed",value:function(e){return this.pressed[e]}},{key:"onKeydown",value:function(e){!0!==this.pressed[e.keyCode]&&(this.pressed[e.keyCode]=!0,this.addLastPressed(e.keyCode))}},{key:"onKeyup",value:function(e){delete this.pressed[e.keyCode]}},{key:"onClickStart",value:function(e,t){if(!0!==Ve.device.isResizing){var n=new l(e,t),i=Ve.device.getGlobalScroll();n.x+=i.x,n.y+=i.y,n.x<Ve.device.canvasGlobalOffset.x||n.y<Ve.device.canvasGlobalOffset.y||n.x>Ve.device.canvasGlobalOffset.x+Ve.core.canvas.width||n.y>Ve.device.canvasGlobalOffset.y+Ve.core.canvas.height||(n.x-=Ve.device.canvasGlobalOffset.x,n.y-=Ve.device.canvasGlobalOffset.y,this.currentInputController.detectClick(n))}}},{key:"resetKeys",value:function(){for(var e in this.pressed)this.pressed[e]=!1}},{key:"addLastPressed",value:function(e){this.currentInputController.informKeyPressed(e);var t=(new Date).getTime();t-this.lastPressedTime>1e3&&(this.lastPressed=[]),this.lastPressedTime=t,this.lastPressed.push(e),this.lastPressed.length>10&&this.lastPressed.shift(),!0===Ve.options.outputPressedKeys&&Ve.logs.log("Input.addLastPressed","Pressed key: "+this.inverseKeyboard[e],t);var n=this.currentInputController.detectCombo();null!==n&&this.currentInputController.informComboPerformed(n,t)}},{key:"addClick",value:function(e){this.currentInputController.informClick(e),!0===Ve.options.outputClicks&&Ve.logs.log("Input.addClick","Click over: "+e)}},{key:"getKeyFromCode",value:function(e){return this.inverseKeyboard[e]}},{key:"convertKeyToNumber",value:function(e){switch(e){case d.NINE:return 9;case d.EIGTH:return 8;case d.SEVEN:return 7;case d.SIX:return 6;case d.FIVE:return 5;case d.FOUR:return 4;case d.THREE:return 3;case d.TWO:return 2;case d.ONE:return 1;case d.ZERO:return 0}return-1}},{key:"convertNumberToKey",value:function(e){switch(e){case 9:return d.NINE;case 8:return d.EIGTH;case 7:return d.SEVEN;case 6:return d.SIX;case 5:return d.FIVE;case 4:return d.FOUR;case 3:return d.THREE;case 2:return d.TWO;case 1:return d.ONE;case 0:return d.ZERO}return d.ZERO}},{key:"isTargetInput",value:function(e){return"textarea"==e.target.type||"text"==e.target.type||"number"==e.target.type||"email"==e.target.type||"password"==e.target.type||"search"==e.target.type||"tel"==e.target.type||"url"==e.target.type||e.target.isContentEditable}}])&&f(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.combos={},this.comboListeners={},this.keyListeners={},this.clickableZones={},this.clickListeners=[]}var t,n;return t=e,(n=[{key:"initialize",value:function(){}},{key:"activate",value:function(){Ve.input.setCurrentInputController(this),this.addKeyListener(Ve.core,"eventKeyPressed",[d.P,d.ESC,d.F],!0)}},{key:"addKeyListener",value:function(e,t,n,i){void 0===i&&(i=!1);var r={};r.listeningOb=e,r.listeningFunc=t,r.onPause=i;for(var o=0,s=n.length;o<s;o++)void 0===this.keyListeners[n[o]]?this.keyListeners[n[o]]=[r]:this.keyListeners[n[o]].push(r)}},{key:"addClickListener",value:function(e,t,n){void 0===n&&(n=!1);var i={};i.listeningOb=e,i.listeningFunc=t,i.onPause=n,this.clickListeners.push(i)}},{key:"removeListeners",value:function(e){var t,n,i,r;for(t in this.keyListeners)for(n=0,r=this.keyListeners[t].length;n<r;n++)this.keyListeners[t][n].listeningOb==e&&(this.keyListeners[t].splice(n,1),this.keyListeners[t].length||delete this.keyListeners[t]);for(t=0,i=this.clickListeners.length;t<i;t++)for(n=0,r=this.clickListeners[t].length;n<r;n++)this.clickListeners[t][n].listeningOb==e&&this.clickListeners[t].splice(n,1)}},{key:"informKeyPressed",value:function(e){var t=[];if(void 0!==this.keyListeners[e]&&(t=t.concat(this.keyListeners[e])),void 0!==this.keyListeners[d.ANY_KEY]&&(t=t.concat(this.keyListeners[d.ANY_KEY])),void 0!==t)for(var n=0,i=t.length;n<i;n++){var r=t[n];!r.onPause&&Ve.paused||void 0!==r.listeningOb[r.listeningFunc]&&r.listeningOb[r.listeningFunc](e)}}},{key:"informClick",value:function(e){if(void 0!==this.clickListeners)for(var t=0,n=this.clickListeners.length;t<n;t++){var i=this.clickListeners[t];!i.onPause&&Ve.paused||void 0!==i.listeningOb[i.listeningFunc]&&i.listeningOb[i.listeningFunc](e)}}},{key:"defineCombo",value:function(e,t,n){this.combos[e]={comboType:t,comboKeys:n,lastTime:0}}},{key:"addComboListener",value:function(e,t,n,i){void 0===i&&(i=!1);var r=[];r.listeningOb=e,r.listeningFunc=t,r.onPause=i;for(var o=0,s=n.length;o<s;o++)void 0===this.comboListeners[n[o]]?this.comboListeners[n[o]]=[r]:this.comboListeners[n[o]].push(r)}},{key:"informComboPerformed",value:function(e,t){!0===Ve.options.outputPressedCombos&&Ve.logs.log("Input.informComboPerformed","Combo activated: "+e,t),this.combos[e].lastTime=t;var n=this.comboListeners[e];if(void 0!==n)for(var i=0,r=n.length;i<r;i++){var o=n[i];!o.onPause&&Ve.paused||void 0!==o.listeningOb[o.listeningFunc]&&o.listeningOb[o.listeningFunc](e)}}},{key:"detectCombo",value:function(){for(var e in this.combos){var t=this.combos[e],n=void 0,i=void 0;if(t.comboType==v.SIMULTANEOUS){for(n=0,i=t.comboKeys.length;n<i&&Ve.input.isKeyPressed(t.comboKeys[n]);n++)if(n==i-1&&Ve.input.isKeyPressed(t.comboKeys[n]))return e}else if(t.comboType==v.CONSECUTIVE){var r=Ve.input.lastPressed.length,o=t.comboKeys.length;if(r<o)return null;for(n=1;n<=o&&n<=r&&t.comboKeys[o-n]==Ve.input.lastPressed[r-n];n++)if(n>=o||n>=r)return e}}return null}},{key:"addClickZone",value:function(e,t,n,i){this.clickableZones[e]={position:t,size:n,character:i}}},{key:"detectClick",value:function(e){for(var t in this.clickableZones){var n=this.clickableZones[t];e.x>=n.position.x-n.size.x/2&&e.x<=n.position.x+n.size.x/2&&e.y>=n.position.y-n.size.y/2&&e.y<=n.position.y+n.size.y/2&&(null!==n.character&&Ve.input.addLastPressed(n.character),Ve.input.addClick(t))}}}])&&p(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),d={ANY_KEY:-1,INSERT:45,DELETE:46,SPACEBAR:32,ESC:27,BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222,NTILDE:209},v={CONSECUTIVE:1,SIMULTANEOUS:2};function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.FRAMES_PER_SECOND=60,this.TIME_PER_FRAME=1e3/this.FRAMES_PER_SECOND,this.paused=!1,this.halted=!1,this.canvas=null,this.ctx=null,this.size=new l(500,500),this.useAnimationFrame=!1,this.timeLastRender=(new Date).getTime(),this.timeGameStart=(new Date).getTime(),this.fpsPassed=0,this.fps=this.FRAMES_PER_SECOND}var t,n;return t=e,(n=[{key:"initialize",value:function(e){return Ve.logs.log("Engine::Core.initialize","Initializing engine core object"),this.canvas=document.getElementById(e),this.size.x=this.canvas.width,this.size.y=this.canvas.height,this.timeLastRender=(new Date).getMilliseconds(),this.ctx=this.canvas.getContext&&this.canvas.getContext("2d"),this.ctx?(Ve.logs.log("Engine::Core.initialize","UserAgent: "+Ve.device.getUserAgent()),!1===Ve.options.useAnimationFrame||null===window.requestAnimationFrame?(this.useAnimationFrame=!1,Ve.logs.log("Engine::Core.initialize","NOT using requestAnimationFrame")):(this.useAnimationFrame=!0,Ve.logs.log("Engine::Core.initialize","Modern browser, using requestAnimationFrame")),this.loop(),1):(Ve.logs.log("Engine::Core.initialize","Old browser, unable to create canvas context"),alert("Unable to get canvas context. Old browser?"),null)}},{key:"activate",value:function(){Ve.logs.log("Engine::activate","Starting engine"),Ve.game.activate(),Ve.scenes.advanceScene()}},{key:"eventKeyPressed",value:function(e){e==d.P&&!0===Ve.options.allowPause?this.paused?this.unpauseGame():!1!==Ve.scenes.getCurrentScene().playable&&this.pauseGame():e==d.ESC&&!0===Ve.options.allowHalt?this.halted?(this.halted=!1,Ve.logs.log("Engine::eventKeyPressed","Engine un-halted"),this.timeLastRender=(new Date).getTime(),this.loop()):(this.halted=!0,Ve.logs.log("Engine::eventKeyPressed","Engine halted"),Ve.scenes.getCurrentScene().gui.get("console").addText("halt","Engine halted"),Ve.scenes.getCurrentScene().gui.draw(this.ctx)):e!=d.F||!0!==Ve.options.allowFForFps||this.paused||this.halted||(!0===Ve.options.showFps?Ve.options.showFps=!1:Ve.options.showFps=!0)}},{key:"loop",value:function(){var e=(new Date).getTime(),t=e-this.timeLastRender;if(t>=Ve.core.TIME_PER_FRAME){this.timeLastRender=e;var n=Ve.scenes.getCurrentScene();if(this.halted)return;n&&!0===n.isCurrent&&(!1===this.paused&&(n.step(t),void 0!==Ve.game&&Ve.game.step(t),Ve.effects.step(t),Ve.particles.step(t)),Ve.clock.step(t),Ve.player.step(t),n.draw(this.ctx),Ve.effects.draw(this.ctx),Ve.particles.draw(this.ctx),this.fpsPassed++,!0===Ve.options.showStatistics&&(n.getAttachedItems().length>0&&n.gui.get("console").addText("numItems",n.getAttachedItems().length+" "+Ve.localization.get("items")),Ve.effects.effects.length>0&&n.gui.get("console").addText("numEffects",Ve.effects.effects.length+" "+Ve.localization.get("effects")),Ve.particles.particles.length>0&&n.gui.get("console").addText("numParticles",Ve.particles.particles.length+" "+Ve.localization.get("particles")))),t=0}!0===this.useAnimationFrame?window.requestAnimationFrame((function(){Ve.core.loop()})):setTimeout((function(){Ve.core.loop()}),Ve.core.TIME_PER_FRAME-t)}},{key:"clearScreen",value:function(){this.ctx.clearRect(0,0,this.size.x,this.size.y)}},{key:"pauseGame",value:function(){!1!==Ve.options.allowPause&&(this.paused=!0,Ve.scenes.getCurrentScene().pauseGame())}},{key:"unpauseGame",value:function(){!1!==Ve.options.allowPause&&(this.paused=!1,Ve.scenes.getCurrentScene().unpauseGame())}}])&&g(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var A=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvasGlobalOffset=new l,this.isTouchDevice=!1,this.isResizing=!1,this._clearTimeOutId=null}var t,n;return t=e,(n=[{key:"initialize",value:function(){var e=this;this.isTouchDevice=this.detectTouchDevice(),this.isTouchDevice?Ve.logs.log("Engine::Initialize","Touch device detected"):Ve.logs.log("Engine::Initialize","Touch device NOT detected"),this.canvasGlobalOffset=Ve.device.getGlobalOffset(Ve.core.canvas),c("resize",window,(function(){Ve.device.isResizing=!0,!0===Ve.options.showResizeMessage&&Ve.gui.get("console").addText("resize","Resizing!"),Ve.device.canvasGlobalOffset=Ve.device.getGlobalOffset(Ve.core.canvas),clearTimeout(e._clearTimeOutId),e._clearTimeOutId=setTimeout(Ve.device.doneResizing,1e3)})),!0===Ve.options.avoidLeavingPage&&this.avoidLeavingPage()}},{key:"doneResizing",value:function(){Ve.device.isResizing=!1,!0===Ve.options.showResizeMessage&&Ve.gui.get("console").addText("resize","Resizing done")}},{key:"activate",value:function(){}},{key:"getGlobalScroll",value:function(){var e=new l(0,0);if(window.pageYOffset)e.x=window.pageXOffset,e.y=window.pageYOffset;else{var t=document.getElementsByTagName("html")[0];t.scrollTop&&(e.x=t.scrollLeft,e.y=t.scrollTop)}return e}},{key:"getGlobalOffset",value:function(e){var t=new l(0,0);for(t.x=e.offsetLeft,t.y=e.offsetTop;e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}},{key:"detectTouchDevice",value:function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}},{key:"getUserAgent",value:function(){return navigator.userAgent}},{key:"avoidLeavingPage",value:function(){window.onbeforeunload=function(){return""}}},{key:"createAndDownloadFile",value:function(e,t){if(window.navigator.msSaveOrOpenBlob){var n=new Blob([t],{type:"text/csv;charset=utf-8;"});window.navigator.msSaveOrOpenBlob(n,e)}else{var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),i.setAttribute("download",e),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}},{key:"detectIE",value:function(){var e=navigator.userAgent.toLowerCase();return/msie/.test(e)?parseFloat((e.match(/.*(?:rv|ie)[/: ](.+?)([ );]|$)/)||[])[1]):navigator.appVersion.indexOf("Trident/")>0?11:-1}},{key:"isIE",value:function(){return-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0}}])&&b(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var k=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.angle=0,this.a=1,this.b=0,this.c=0,this.d=1}var t,n;return t=e,(n=[{key:"getAngle",value:function(){return this.angle}},{key:"rotate",value:function(e){this.update(this.angle+e)}},{key:"update",value:function(e){this.angle=e,this.a=Math.cos(this.angle),this.b=-Math.sin(this.angle),this.c=Math.sin(this.angle),this.d=Math.cos(this.angle)}},{key:"transformPosition",value:function(e){return new l(e.x*this.a+e.y*this.b,e.x*this.c+e.y*this.d)}}])&&w(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var x=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.spriteName=null,this._visible=!0,this.position=new l,this.size=new l,this.scaling=new l(1,1),this.speed=new l,this.maxVel=0,this.accel=0,this.vRot=0,this.maxVRot=0,this.accelRot=0,this.rotation=new k,this.globalAlpha=1,this.maxRadius=0,this.collisionRadius=0,this.isAnimated=!1,this.currentFrame=0,this.numLoops=1,this.forceFrameSpeed=0,this.timeLastFrame=0,this._attachedItems=[],this._removedItems=[],this._parent=null}var t,n;return t=e,(n=[{key:"initialize",value:function(){}},{key:"activate",value:function(){for(var e=0,t=this._attachedItems.length;e<t;e++)this._attachedItems[e].activate()}},{key:"getVisible",value:function(){return this._visible}},{key:"setVisible",value:function(e){this._visible=e}},{key:"getParent",value:function(){return this._parent}},{key:"setParent",value:function(e){this._parent=e}},{key:"getParentScene",value:function(){for(var e=this;null!==e.getParent();)e=e.getParent();return e===this?Ve.scenes.getCurrentScene():e}},{key:"getAttachedItems",value:function(){return this._attachedItems}},{key:"attachItem",value:function(e){this._attachedItems.push(e),e.setParent(this)}},{key:"detachItem",value:function(e){var t=this.getParentScene();t.input.removeListeners(e);for(var n=e.children(),i=0,r=n.length;i<r;i++)t.input.removeListeners(n[i]);this._removedItems.push(e),e.setParent(null)}},{key:"detachAllItems",value:function(){for(var e=0,t=this._attachedItems.length;e<t;e++){var n=this._attachedItems[e];n.detachAllItems(),this.detachItem(n)}this._finalizeRemoved()}},{key:"children",value:function(){for(var e=[],t=0,n=this._attachedItems.length;t<n;t++)e=(e=e.concat(this._attachedItems[t])).concat(this._attachedItems[t].children());return e}},{key:"_resetItems",value:function(){this._attachedItems.length=0}},{key:"_resetRemoved",value:function(){this._removedItems.length=0}},{key:"_finalizeRemoved",value:function(){for(var e=0,t=this._removedItems.length;e<t;e++){var n=this._removedItems[e],i=this._attachedItems.indexOf(n);-1!=i&&this._attachedItems.splice(i,1)}this._resetRemoved()}},{key:"setImage",value:function(e){this.spriteName=e,this.size=Ve.sprites.getSpriteSize(e)}},{key:"getOrigin",value:function(){var e=this.getPosition();return new l(e.x-this.size.x/2,e.y-this.size.y/2)}},{key:"getPosition",value:function(){var e=new l,t=new l,n=new l;return null!==this._parent?(t=this._parent.getPosition(),n=this._parent.rotation.transformPosition(this.position),e.x=n.x+t.x,e.y=n.y+t.y):(e.x=this.position.x,e.y=this.position.y),e}},{key:"setPosition",value:function(e,t){this.position.x=e,this.position.y=t}},{key:"getSize",value:function(){return this.size}},{key:"setSize",value:function(e,t){this.size.x=e,this.size.y=t}},{key:"getScaling",value:function(){return this.scaling}},{key:"setScaling",value:function(e,t){this.scaling.x=e,this.scaling.y=t}},{key:"getSpeed",value:function(){return this.speed}},{key:"setSpeed",value:function(e,t){this.speed.x=e,this.speed.y=t}},{key:"getParentPosition",value:function(){return null!==this._parent?this._parent.getPosition():new l}},{key:"getParentSpeed",value:function(){return null!==this._parent?this._parent.getSpeed():new l}},{key:"getRadius",value:function(){return Math.sqrt(Math.pow(this.size.x/2,2)+Math.pow(this.size.y/2,2))}},{key:"getMagnitude",value:function(){return Math.sqrt(this.speed.x*this.speed.x+this.speed.y*this.speed.y)}},{key:"move",value:function(e,t){this.position.x+=e,this.position.y+=t}},{key:"rotate",value:function(e){this.rotation.rotate(e)}},{key:"setRotation",value:function(e){this.rotation.update(e)}},{key:"getRotation",value:function(){return null!==this._parent?this.rotation.getAngle()+this._parent.getRotation():this.rotation.getAngle()}},{key:"draw",value:function(e){if(!0===this._visible){for(var t=0,n=this._attachedItems.length;t<n;t++)this._attachedItems[t].draw(e);null!==this.spriteName&&Ve.sprites.draw(e,this),!0===Ve.options.drawBoundingBoxes&&this.drawHelper(e,"spriteBox"),!0===Ve.options.drawMaxRadius&&this.drawHelper(e,"maxRadius"),!0===Ve.options.drawCollisionRadius&&this.drawHelper(e,"collisionRadius"),!0===Ve.options.drawOrigins&&this.drawHelper(e,"origin"),!0===Ve.options.drawCenters&&this.drawHelper(e,"center"),!0===Ve.options.drawDirectionVectors&&this.drawHelper(e,"direction")}}},{key:"step",value:function(e){0===this.speed.x&&0===this.speed.y||this.move(this.speed.x*e/Ve.core.TIME_PER_FRAME,this.speed.y*e/Ve.core.TIME_PER_FRAME),0!==this.vRot&&this.rotate(this.vRot*e/Ve.core.TIME_PER_FRAME),!0===this.isAnimated&&null!==this.spriteName&&Ve.sprites.step(e,this);for(var t=0,n=this._attachedItems.length;t<n;t++)this._attachedItems[t].step(e);this._finalizeRemoved()}},{key:"eventAnimationRestart",value:function(){}},{key:"drawHelper",value:function(e,t){var n=this.getPosition(),i=this.getSize(),r=this.getScaling();if("maxRadius"==t)e.beginPath(),e.arc(n.x,n.y,this.maxRadius,0,2*Math.PI,!1),e.closePath(),e.lineWidth=1,e.strokeStyle="#FF0000",e.stroke();else if("collisionRadius"==t)e.beginPath(),e.arc(n.x,n.y,this.collisionRadius,0,2*Math.PI,!1),e.closePath(),e.lineWidth=1,e.strokeStyle="#FF0000",e.stroke();else if("origin"==t)e.fillStyle="#FF0000",e.fillRect(n.x-i.x/2*r.x,n.y-i.y/2*r.y,2,2);else if("center"==t)e.fillStyle="#FF0000",e.fillRect(n.x,n.y,2,2);else if("spriteBox"==t)e.lineWidth=1,e.strokeStyle="#FF0000",e.strokeRect(n.x-i.x/2*r.x,n.y-i.y/2*r.y,i.x*r.x,i.y*r.y);else if("direction"==t){var o=this.getSpeed();e.lineWidth=1,e.strokeStyle="#FF0000",e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(n.x+10*o.x,n.y+10*o.y),e.stroke()}}},{key:"collide",value:function(){return this.detachAllItems(),!0}}])&&O(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function E(){return E="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=T(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},E.apply(this,arguments)}function T(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}function R(e,t){if(t&&("object"===P(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},C(e)}var z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=C(i);if(r){var n=C(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return R(this,e)});function s(e,t,n,i,r){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a=o.call(this);var c=Ve.sprites.sprites[e];return a.size=new l(c[3],c[4]),a.numFrames=c[5],a.position=new l(t,n),a.speed=new l(i,r),a.lived=0,a.lifeTime=0,a.maxLoops=1,a.spriteName=e,a.initialScaling=1,a.finalScaling=1,a.transparencyMethod=0,a.globalAlpha=1,a}return t=s,(n=[{key:"step",value:function(e){E(C(s.prototype),"step",this).call(this,e),this.lived++;var t=1;1==this.initialScaling&&1==this.finalScaling||(t=this.initialScaling+(this.finalScaling-this.initialScaling)*this.lived/this.lifeTime,this.scaling.x=t,this.scaling.y=t),2==this.transparencyMethod?0!==this.lifeTime?this.globalAlpha=1-this.lived/this.lifeTime:this.globalAlpha=1-this.currentFrame/this.numFrames:1==this.transparencyMethod&&(0!==this.lifeTime?this.globalAlpha=this.lived/this.lifeTime:this.globalAlpha=this.currentFrame/this.numFrames),!0===this.isAnimated&&Ve.sprites.step(e,this)}},{key:"draw",value:function(e){E(C(s.prototype),"draw",this).call(this,e)}}])&&S(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(x);function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.effects=[],this.removed=[]}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.effects.length=0}},{key:"removeEffect",value:function(e){this.removed.push(e)}},{key:"_resetRemoved",value:function(){this.removed.length=0}},{key:"_finalizeRemoved",value:function(){for(var e=0,t=this.removed.length;e<t;e++){var n=this.effects.indexOf(this.removed[e]);-1!=n&&this.effects.splice(n,1)}}},{key:"step",value:function(e){this._resetRemoved();for(var t=0,n=this.effects.length;t<n;t++){var i=this.effects[t];i.step(e),i.lifeTime>0&&i.lived>i.lifeTime&&this.removeEffect(i),i.maxLoops>0&&i.numLoops>i.maxLoops&&this.removeEffect(i)}this._finalizeRemoved()}},{key:"draw",value:function(e){for(var t=0,n=this.effects.length;t<n;t++)this.effects[t].draw(e)}},{key:"addEffect",value:function(e,t,n,i,r){var o=new z(e,t,n,i,r);return this.effects.push(o),o}}])&&I(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function F(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var L=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.particles=[],this.maxParticles=1e4,this._removedParticles=[],this.effectField=document.createElement("canvas"),this.effectField.width=Ve.core.size.x,this.effectField.height=Ve.core.size.y,this.effectField.ctx=this.effectField.getContext("2d")}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.particles=[],this.maxParticles=1e4,this._removedParticles=[]}},{key:"addParticle",value:function(e){this.particles.length>this.maxParticles||this.particles.push(e)}},{key:"removeParticle",value:function(e){this._removedParticles.push(e)}},{key:"_resetItems",value:function(){this.particles.length=0}},{key:"_resetRemoved",value:function(){this._removedParticles.length=0}},{key:"_finalizeRemoved",value:function(){for(var e=0,t=this._removedParticles.length;e<t;e++){var n=this._removedParticles[e],i=this.particles.indexOf(n);-1!=i&&this.particles.splice(i,1)}}},{key:"step",value:function(e){var t,n,i=this.particles.length;for(t=0;t<i;t++)(n=this.particles[t]).lived>n.ttl?this.removeParticle(n):n.step(e);this._finalizeRemoved()}},{key:"draw",value:function(e){if(this.particles.length>0){this.effectField.ctx.clearRect(0,0,Ve.core.size.x,Ve.core.size.y);for(var t,n=-1;t=this.particles[++n];){var i=[t.color[0]-3*t.lived,t.color[1]-t.lived,t.color[2],t.color[3]];this.effectField.ctx.fillStyle="rgba("+i.join(",")+")",this.effectField.ctx.fillRect(t.position.x,t.position.y,t.size,t.size)}e.drawImage(this.effectField,0,0,Ve.core.size.x,Ve.core.size.y)}}}])&&F(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var M=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sprites={},this.images={}}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.sprites.length=0,this.images.length=0}},{key:"step",value:function(e,t){var n=this.sprites[t.spriteName][7],i=this.sprites[t.spriteName][5],r=this.sprites[t.spriteName][6];if(0!==t.forceFrameSpeed&&(n=t.forceFrameSpeed),i>1){var o=(new Date).getTime();if(0===t.timeLastFrame&&(t.timeLastFrame=o),o-t.timeLastFrame>1e3/n){var s=t.currentFrame;t.currentFrame++,t.currentFrame>=r+i&&(t.currentFrame=r),t.timeLastFrame=o,s==i-1&&(t.numLoops+=1,void 0!==t.eventAnimationRestart&&t.eventAnimationRestart())}}}},{key:"draw",value:function(e,t){if(!1!==t.getVisible()){var n=this.sprites[t.spriteName][0],i=this.sprites[t.spriteName][1],r=this.sprites[t.spriteName][2],o=this.sprites[t.spriteName][3],s=this.sprites[t.spriteName][4],a=t.getPosition();e.globalAlpha=t.globalAlpha,0!==t.rotation.getAngle()?(e.save(),e.translate(a.x,a.y),e.rotate(t.rotation.getAngle()),e.drawImage(this.images[n],i+t.currentFrame*o,r,o,s,-o/2*t.scaling.x,-s/2*t.scaling.y,o*t.scaling.x,s*t.scaling.y),e.restore()):e.drawImage(this.images[n],i+t.currentFrame*o,r,o,s,a.x-o/2*t.scaling.x,a.y-s/2*t.scaling.y,o*t.scaling.x,s*t.scaling.y),e.globalAlpha=1}}},{key:"imageExists",value:function(e){return Object.prototype.hasOwnProperty.call(this.images,e)}},{key:"spriteExists",value:function(e){return Object.prototype.hasOwnProperty.call(this.sprites,e)}},{key:"addImage",value:function(e,t){this.images[e]=t}},{key:"addSprite",value:function(e,t,n,i,r,o,s,a,l){this.sprites[e]=[t,n,i,r,o,s,a,l]}},{key:"getImage",value:function(e){return this.images[this.sprites[e][0]]}},{key:"getImageFromPath",value:function(e){return this.images[e]}},{key:"getSpriteData",value:function(e){var t=this.sprites[e];return void 0!==t?t:null}},{key:"getSpriteInfo",value:function(e,t){var n=this.sprites[e];if(void 0!==n){var i=n[t];if(void 0!==i)return i}return null}},{key:"getSpriteSize",value:function(e){var t=this.sprites[e],n=0,i=0;return void 0!==t&&(n=t[3],i=t[4]),new l(n,i)}}])&&N(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function D(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var B=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sounds={}}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.sounds.length=0}},{key:"step",value:function(){}},{key:"soundExists",value:function(e){for(var t=Object.keys(this.sounds),n=0,i=t.length;n<i;n++)if(this.sounds[t[n]][1]==e)return!0;return!1}},{key:"addSound",value:function(e,t,n){this.sounds[e]=[n,t]}},{key:"get",value:function(e){if(void 0===this.sounds[e])return null;var t=this.sounds[e][0];return t.currentTime>0&&(t=t.cloneNode()),t}},{key:"play",value:function(e){var t=this.get(e);null!==t&&(t.currentTime>0&&(t.currentTime=0),t.play())}}])&&D(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function K(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var G=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fonts={}}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.fonts.length=0}},{key:"step",value:function(){}},{key:"fontExists",value:function(e){for(var t=Object.keys(this.fonts),n=0,i=t.length;n<i;n++)if(this.fonts[t[n]][1]==e)return!0;return!1}},{key:"addFont",value:function(e,t,n){this.fonts[e]=[n,t]}},{key:"get",value:function(e){return void 0===this.fonts[e]?null:this.fonts[e][0]}}])&&K(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function U(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var H=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collection=null,this.currentSceneIndex=null,this.currentSceneName=null,this.currentScene=null}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.collection=[],this.currentSceneIndex=0,this.currentSceneName="",this.currentScene=null}},{key:"activate",value:function(){}},{key:"draw",value:function(){}},{key:"step",value:function(){}},{key:"getCurrentScene",value:function(){return this.currentScene}},{key:"setScene",value:function(e){void 0!==this.currentScene&&null!==this.currentScene&&(this.currentScene.isCurrent=!1),Ve.core.clearScreen(),this.currentSceneIndex=e,this.currentSceneName=Ve.scenes.collection[e].name,this.currentScene=Ve.scenes.collection[e].scene,this.currentScene.isCurrent=!0,this.currentScene.activate(),void 0!==Ve.player&&null!==Ve.player&&Ve.player.activate(),Ve.logs.log("Scenes::setScene","Set Scene: "+this.currentSceneName+" ("+this.currentSceneIndex+")"),Ve.external("SCENE_CHANGE",null,null)}},{key:"addScene",value:function(e,t){Ve.logs.log("Scenes::addScene","Add Scene: "+t),e.isCurrent=!1,this.collection.push({scene:e,name:t})}},{key:"insertScene",value:function(e,t,n){e.isCurrent=!1,this.collection.splice(n,0,{scene:e,name:t})}},{key:"advanceScene",value:function(){Ve.scenes.currentSceneIndex+1>=Ve.scenes.collection.length||Ve.scenes.setScene(Ve.scenes.currentSceneIndex+1)}},{key:"goBackScene",value:function(){this.currentSceneIndex-1<0||this.setScene(this.currentSceneIndex-1)}}])&&U(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var W=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.startTime=0,this.passedTime=0,this.ticker500=0,this.listeners500={},this.ticker1=0,this.listeners1={},this.ticker5=0,this.listeners5={}}var t,n;return t=e,(n=[{key:"initialize",value:function(){this.startTime=(new Date).getTime()}},{key:"activate",value:function(){}},{key:"step",value:function(e){this.ticker1+=e,this.ticker5+=e,this.ticker500+=e,this.ticker1>=1e3&&(this.informListeners(this.listeners1),this.ticker1=0),this.ticker5>=5e3&&(this.informListeners(this.listeners5),this.ticker5=0),this.ticker500>=500&&(this.informListeners(this.listeners500),this.ticker500=0)}},{key:"draw",value:function(){}},{key:"suscribe500",value:function(e,t){this.listeners500[e]=t}},{key:"suscribeOneSecond",value:function(e,t){this.listeners1[e]=t}},{key:"suscribeFiveSeconds",value:function(e,t){this.listeners5[e]=t}},{key:"informListeners",value:function(e){for(var t in e)e[t]()}}])&&V(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fallbackLanguage="english",this.selectedLanguage="",this.stringTables={},this.baseTexts={english:{paused:"Paused, press P to continue",loaded:"Loading",items:"items",effects:"effects",particles:"particles",choose_language:"Choose language",english:"English",spanish:"Spanish"},spanish:{paused:"Pausa, pulsa P para continuar",loaded:"Cargando",items:"elementos",effects:"efectos",particles:"partículas",choose_language:"Escoge el idioma",english:"English",spanish:"Español"}}}var t,n;return t=e,(n=[{key:"initialize",value:function(){for(var e in this.selectedLanguage="english",this.baseTexts)this.stringTables[e]=[],this.addTextsToStringTable(e,this.baseTexts[e])}},{key:"get",value:function(e){var t=this.stringTables[this.selectedLanguage][e];return void 0!==t?t:this.stringTables[this.fallbackLanguage][e]}},{key:"addStringTable",value:function(e,t){this.stringTables[e]=t}},{key:"setBaseTexts",value:function(e){this.baseTexts=e}},{key:"addTextsToStringTable",value:function(e,t){for(var n in t)this.stringTables[e][n]=t[n]}},{key:"selectLanguage",value:function(e){this.selectedLanguage=e}}])&&q(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function X(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Z(){return Z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=J(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},Z.apply(this,arguments)}function J(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=te(e)););return e}function $(e,t){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$(e,t)}function ee(e,t){if(t&&("object"===Q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function te(e){return te=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},te(e)}var ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=te(i);if(r){var n=te(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ee(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).guiId=null,void 0!==e?t.setParent(e):t.guiId="globalGUI",t.inputCallbacks={},t.guiElements={},t.blink=!1,t}return t=s,(n=[{key:"initialize",value:function(){Z(te(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){Z(te(s.prototype),"activate",this).call(this)}},{key:"draw",value:function(e){Z(te(s.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){Z(te(s.prototype),"step",this).call(this,e)}},{key:"setBlink",value:function(e){var t=this.getParentScene();null!==t&&(!0===e?(this.blink=!0,t.clock.suscribe(this.guiId+"_clock",this,"blinkStep",350)):(this.blink=!1,this.setVisible(!0),t.clock.unsuscribe(this.guiId+"_clock")))}},{key:"blinkStep",value:function(){!0===this.blink&&!0===this.getVisible()?this.setVisible(!1):(!0===this.blink&&!1===this.getVisible()||!1===this.blink)&&this.setVisible(!0)}},{key:"addInputCallback",value:function(e,t){var n=this.getParentScene();null!==n&&(n.input.addKeyListener(this,"eventKeyPressed",[e],!0),this.inputCallbacks[e]=t)}},{key:"eventKeyPressed",value:function(e){void 0!==this.inputCallbacks[e]&&this.inputCallbacks[e]()}},{key:"getElement",value:function(e){var t=this.guiElements[e];return void 0!==t?t:null}},{key:"get",value:function(e){return this.getElement(e)}},{key:"attachItem",value:function(e,t){this.guiElements[t]=e,e.guiId=t,Z(te(s.prototype),"attachItem",this).call(this,e)}},{key:"detachItem",value:function(e){void 0!==e&&(Z(te(s.prototype),"detachItem",this).call(this,this.get(e)),delete this.guiElements[e])}},{key:"detachAllItems",value:function(){for(var e=Object.keys(this.guiElements),t=0,n=e.length;t<n;t++)this.guiElements[e[t]].detachAllItems(),this.detachItem(e[t]);this.guiElements={},this._finalizeRemoved()}},{key:"_resetItems",value:function(){this.attachedItems.length=0,this.guiElements={}}}])&&X(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(x);function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function re(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function oe(){return oe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=se(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},oe.apply(this,arguments)}function se(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ce(e)););return e}function ae(e,t){return ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ae(e,t)}function le(e,t){if(t&&("object"===ie(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ce(e){return ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ce(e)}var ue=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ae(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ce(i);if(r){var n=ce(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return le(this,e)});function s(e,t,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this)).text=e,i.font='base,BaseFont,"Courier New"',i.fontSize=20,i.fontColor="#FFFFFF",i.fontBorderColor="#000000",i.textAlign=we.LEFT,i.verticalOffset=20,i.horizontalOffset=10,void 0===t||void 0===n?(i.size.x=100,i.size.y=30):(i.size.x=t,i.size.y=n),i._canvasRendering=!0,i._innerCanvas=document.createElement("canvas"),i._innerCanvas.width=i.size.x,i._innerCanvas.height=i.size.y,i._innerContext=i._innerCanvas.getContext("2d"),i._innerChange=!0,i}return t=s,(n=[{key:"initialize",value:function(){oe(ce(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){oe(ce(s.prototype),"activate",this).call(this)}},{key:"setSize",value:function(e,t){oe(ce(s.prototype),"setSize",this).call(this,e,t),this._innerCanvas.width=this.size.x,this._innerCanvas.height=this.size.y,this._innerChange=!0}},{key:"setText",value:function(e){this.text!=e&&(this.text=e,this._innerChange=!0)}},{key:"getText",value:function(){return this.text}},{key:"_updateInnerRender",value:function(e){var t=new l(this.horizontalOffset,this.verticalOffset);this.textAlign==we.CENTER?t.x=this.size.x/2:this.textAlign==we.RIGHT&&(t.x=this.size.x-this.horizontalOffset),this._innerContext.lineWidth=e.lineWidth,this._innerContext.clearRect(0,0,this.size.x,this.size.y),this._innerContext.strokeStyle=this.fontBorderColor,this._innerContext.fillStyle=this.fontColor,this._innerContext.textAlign=this.textAlign,this._innerContext.font="bold "+this.fontSize+"px "+this.font;for(var n=this.getText().split("\n"),i=0,r=n.length;i<r;i++)this._innerContext.strokeText(n[i],t.x,t.y),this._innerContext.fillText(n[i],t.x,t.y),t.y+=this.verticalOffset;this._innerChange=!1}},{key:"draw",value:function(e){if(!0===this.getVisible()){var t=this.getPosition(),n=this.getSize();if(!1===this._canvasRendering){var i=new l(this.horizontalOffset,this.verticalOffset);this.textAlign==we.CENTER?i.x=this.size.x/2:this.textAlign==we.RIGHT&&(i.x=this.size.x-this.horizontalOffset),e.strokeStyle=this.fontBorderColor,e.fillStyle=this.fontColor,e.textAlign=this.textAlign,e.font="bold "+this.fontSize+"px "+this.font;for(var r=this.getText().split("\n"),o=0,a=r.length;o<a;o++)e.strokeText(r[o],t.x-n.x/2+i.x,t.y-n.y/2+i.y),e.fillText(r[o],t.x-n.x/2+i.x,t.y-n.y/2+i.y),i.y+=this.verticalOffset}else!0===this._innerChange&&this._updateInnerRender(e),e.drawImage(this._innerCanvas,t.x-this.size.x/2,t.y-this.size.y/2)}oe(ce(s.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){oe(ce(s.prototype),"step",this).call(this,e)}},{key:"setFont",value:function(e){this.font=e}},{key:"setFontSize",value:function(e){this.fontSize=e}},{key:"setFontColor",value:function(e){this.fontColor=e}},{key:"setFontBorderColor",value:function(e){this.fontBorderColor=e}},{key:"setAlign",value:function(e){this.textAlign=e}},{key:"setCanvasRendering",value:function(e){this._canvasRendering=e}},{key:"setVerticalOffset",value:function(e){this.verticalOffset=e}},{key:"setHorizontalOffset",value:function(e){this.horizontalOffset=e}}])&&re(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(ne);function fe(e){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(e)}function he(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function pe(){return pe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=ye(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},pe.apply(this,arguments)}function ye(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ge(e)););return e}function de(e,t){return de=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},de(e,t)}function ve(e,t){if(t&&("object"===fe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ge(e){return ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ge(e)}var me=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&de(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ge(i);if(r){var n=ge(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ve(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this))._texts={},e._textKeys=[],e._textsToRemove=[],e.order=be.DOWN,e}return t=s,(n=[{key:"initialize",value:function(){pe(ge(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){pe(ge(s.prototype),"activate",this).call(this)}},{key:"draw",value:function(e){pe(ge(s.prototype),"draw",this).call(this,e)}},{key:"step",value:function(e){var t=this._textKeys.length;if(0!==t){for(var n=0,i=(new Date).getTime(),r=0;r<t;r++){var o=this._texts[this._textKeys[r]],a=o[1];o[2]+2e3<i?this._textsToRemove.push(this._textKeys[r]):(a.setPosition(0,n),this.order==be.DOWN?n+=20:n-=20)}if(pe(ge(s.prototype),"step",this).call(this,e),(t=this._textsToRemove.length)>0){for(var l=0;l<t;l++)this.detachItem(this._textsToRemove[l]),delete this._texts[this._textsToRemove[l]];this._textKeys=Object.keys(this._texts),this._textsToRemove=[]}}}},{key:"addText",value:function(e,t){if(void 0!==this._texts[e])this._texts[e][0]!=t&&(this._texts[e][0]=t,this._texts[e][1].setText(t)),this._texts[e][2]=(new Date).getTime();else{var n=new ue(t,this.size.x,this.size.y);n.setSize(this.size.x,this.size.y),this._texts[e]=[t,n,(new Date).getTime()],this._textKeys=Object.keys(this._texts),this.attachItem(n,e)}}}])&&he(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(ne),be={UP:0,DOWN:1},Ae={SELECTION:0},we={LEFT:"left",RIGHT:"right",CENTER:"center"};function ke(e){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke(e)}function Oe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function xe(){return xe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Pe(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},xe.apply(this,arguments)}function Pe(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_e(e)););return e}function Se(e,t){return Se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Se(e,t)}function Ee(e,t){if(t&&("object"===ke(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Te(e)}function Te(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _e(e){return _e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_e(e)}var Re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Se(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_e(i);if(r){var n=_e(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ee(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this)).playable=!1,e.backgrounds=[],e.isCurrent=!1,e.gui=new ne(Te(e)),e.clock=new W,e.input=new y,e}return t=s,(n=[{key:"initialize",value:function(){var e=this;xe(_e(s.prototype),"initialize",this).call(this);var t=new me;t.setSize(170,30),t.setPosition(15+t.size.x/2,15+t.size.y/2),t.order=be.DOWN,this.gui.initialize(),this.gui.attachItem(t,"console"),this.clock.initialize(),Ve.clock.suscribeOneSecond("FPS",(function(){Ve.options.showFps&&e.gui.get("console").addText("fps",Ve.core.fpsPassed+" fps"),Ve.core.fpsPassed=0})),this.input.initialize()}},{key:"activate",value:function(){xe(_e(s.prototype),"activate",this).call(this),this.gui.activate(),this.clock.activate(),this.input.activate();for(var e=0,t=this.backgrounds.length;e<t;e++)this.backgrounds[e].activate()}},{key:"draw",value:function(e){e.clearRect(0,0,Ve.core.size.x,Ve.core.size.y);for(var t=0,n=this.backgrounds.length;t<n;t++)this.backgrounds[t].draw(e);xe(_e(s.prototype),"draw",this).call(this,e),this.gui.draw(e)}},{key:"step",value:function(e){for(var t=0,n=this.backgrounds.length;t<n;t++)this.backgrounds[t].step(e);this.clock.step(e),xe(_e(s.prototype),"step",this).call(this,e),this.gui.step(e)}},{key:"addBackground",value:function(e){this.backgrounds.push(e)}},{key:"pauseGame",value:function(){if(null===this.gui.get("pause")){var e=new ue(Ve.localization.get("paused"),500,30);e.setFontColor("#FF2222"),e.setAlign(we.CENTER),e.setPosition(Ve.core.size.x/2,Ve.core.size.y/2+100),this.gui.attachItem(e,"pause")}}},{key:"unpauseGame",value:function(){this.gui.detachItem("pause")}}])&&Oe(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(x);function Ce(e){return Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ce(e)}if(!Object.defineProperty)throw"Font.js requires Object.defineProperty, which this browser does not support.";if(!document.createElement("canvas").getContext)throw"Font.js requires <canvas> and the Canvas2D API, which this browser does not support.";function ze(){this.fontFamily="fjs"+(999999*Math.random()|0)}!function(e){try{return void new Uint8Array(1)}catch(e){}function t(e,t){return this.slice(e,t)}function n(e,t){var n,i=e.length;for(arguments.length<2&&(t=0),n=0;n<i;++n,++t)this[t]=255&e[n]}function i(e){var i,r;if("number"==typeof e)for(i=new Array(e),r=0;r<e;++r)i[r]=0;else i=e.slice(0);return i.subarray=t,i.buffer=i,i.byteLength=i.length,i.set=n,"object"===Ce(e)&&e.buffer&&(i.buffer=e.buffer),i}e.Uint8Array=i,e.Uint32Array=i,e.Int32Array=i}(window),function(e){var t;e.opera||"response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype||(t=e.VBArray?function(){return new Uint8Array(new VBArray(this.responseBody).toArray())}:function(){this.responseBody},Object.defineProperty(XMLHttpRequest.prototype,"response",{get:t}))}(window),window.btoa||(window.btoa=function(e){var t,n,i,r,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,l=0,c="",u=[];if(!e)return e;do{t=(o=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,n=o>>12&63,i=o>>6&63,r=63&o,u[l++]=s.charAt(t)+s.charAt(n)+s.charAt(i)+s.charAt(r)}while(a<e.length);c=u.join("");var f=e.length%3;return(f?c.slice(0,f-3):c)+"===".slice(f||3)}),ze.prototype.url="",ze.prototype.format="",ze.prototype.data="",ze.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAAAAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAAAAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAAAAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAABrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHsAAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQAAAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAAAAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1AAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAgAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQABAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEECQABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAAAAAA==",ze.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400},ze.prototype.systemfont=!1,ze.prototype.loaded=!1,ze.prototype.onload=function(){},ze.prototype.onerror=function(){},ze.prototype.canvas=!1,ze.prototype.context=!1,ze.prototype.validate=function(e,t,n,i,r){!1!==r&&r<0?this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed)."):getComputedStyle(e,null).getPropertyValue("width").replace("px","")>0?(document.head.removeChild(t),document.body.removeChild(e),this.loaded=!0,this.onload()):(console.log("timing out"),setTimeout((function(){i.validate(e,t,n,i,!1!==r&&r-50)}),1e3))},ze.prototype.ondownloaded=function(){var e=this,t=function(e){return String.fromCharCode(e)},n=function(e){if(e<256)return t(0)+t(e);var n=255&e;return t(e>>8)+t(n)},i=function(e,t){return 256*e+t},r=function(e,t){var n,i=e>>7==1;return n=256*(e&=127)+t,i?n-32768:n},o=function(e,t,n,i){return 16777216*e+65536*t+256*n+i},s=function(t){e.onerror(t)},a=t(0)+t(1)+t(0)+t(0),l=this.data,c=t(l[0])+t(l[1])+t(l[2])+t(l[3]),u=c===a,f=!u&&"OTTO"===c;if(u)this.format="truetype";else{if(!f)return void s("Error: file at "+this.url+" cannot be interpreted as OpenType font.");this.format="opentype"}var h,p,y=i(l[4],l[5]),d=12+16*y,v={};for(h=12;h<d;h+=16)p=t(l[h])+t(l[h+1])+t(l[h+2])+t(l[h+3]),v[p]={name:p,checksum:o(l[h+4],l[h+5],l[h+6],l[h+7]),offset:o(l[h+8],l[h+9],l[h+10],l[h+11]),length:o(l[h+12],l[h+13],l[h+14],l[h+15])};var g=function(e){return v[e]?e:(s("Error: font is missing the required OpenType '"+e+"' table."),!1)};if(!1!==(p=g("head"))){h=v[p].offset,v[p].version=""+l[h]+l[h+1]+l[h+2]+l[h+3];var m=i(l[h+18],l[h+19]);if(this.metrics.quadsize=m,!1!==(p=g("hhea"))&&(h=v[p].offset,v[p].version=""+l[h]+l[h+1]+l[h+2]+l[h+3],this.metrics.ascent=r(l[h+4],l[h+5])/m,this.metrics.descent=r(l[h+6],l[h+7])/m,this.metrics.leading=r(l[h+8],l[h+9])/m,!1!==(p=g("OS/2"))&&(h=v[p].offset,v[p].version=""+l[h]+l[h+1],this.metrics.weightclass=i(l[h+4],l[h+5]),!1!==(p=g("cmap"))))){h=v[p].offset,v[p].version=""+l[h]+l[h+1],y=i(l[h+2],l[h+3]);for(var b,A,w,k,O=!1,x=0;x<y;x++)A=i(l[b=h+4+8*x],l[b+1]),w=i(l[b+2],l[b+3]),k=o(l[b+4],l[b+5],l[b+6],l[b+7]),3===A&&1===w&&(O=k);var P="A";if(!1!==O&&4===(c=i(l[h+=O],l[h+1]))){for(var S=function(e){return-1===[9,10,11,12,13,32,127,128,129,141,142,143,144,149,157,158,160,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8232,8233,8234,8235,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,12288].indexOf(e)},E=h+14,T=h+14+i(l[h+6],l[h+7])/2*2,_=!1;E<T&&!S(_=i(l[E],l[E+1]));E+=2)_=!1;if(0!=_){P=String.fromCharCode(_);var R=(65536-(_-1))%65536,C=t(0)+n(_)+n(65535)+n(0)+n(_)+n(65535)+n(R)+n(1),z=btoa(C);this.base64=this.base64.substring(0,380)+z+this.base64.substring(380+z.length)}}this.bootstrapValidation(P,!1)}}},ze.prototype.bootstrapValidation=function(e,t){var n=this.fontFamily+" testfont",i=document.createElement("style");i.setAttribute("type","text/css"),i.innerHTML="@font-face {\n  font-family: '"+n+"';\n  src: url('data:application/x-font-ttf;base64,"+this.base64+"')\n       format('truetype');}",document.head.appendChild(i);var r=!1;this.systemfont||(r=this.toStyleNode(),document.head.appendChild(r));var o=document.createElement("p");if(o.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;",o.style.fontFamily="'"+this.fontFamily+"', '"+n+"'",o.innerHTML=e+e+e+e+e+e+e+e+e+e,document.body.appendChild(o),"undefined"==typeof getComputedStyle)this.onload(),error("Error: getComputedStyle is not supported by this browser.\nConsequently, Font.onload() cannot be trusted.");else{var s=this.systemfont?1e3:this.metrics.quadsize,a=document.createElement("canvas");a.width=s,a.height=s,this.canvas=a;var l=a.getContext("2d");l.font="1em '"+this.fontFamily+"'",l.fillStyle="white",l.fillRect(-1,-1,s+2,s+2),l.fillStyle="black",l.fillText("test text",50,s/2),this.context=l;var c=this;setTimeout((function(){c.validate(o,i,r,c,t)}),50)}},ze.prototype.processSystemFont=function(){this.systemfont=!0,this.metrics=!1,this.bootstrapValidation("A",1e3)},ze.prototype.loadFont=function(){var e=this;if(-1!==this.url.indexOf(".")){var t=new XMLHttpRequest;t.open("GET",e.url,!0),t.responseType="arraybuffer",t.onload=function(n){var i=t.response;i?(e.data=new Uint8Array(i),e.ondownloaded()):e.onerror("Error downloading font resource from "+e.url)},t.onerror=function(t){e.onerror("Error downloading font resource from "+e.url)},t.send(null)}else setTimeout((function(){e.processSystemFont()}),10)},ze.prototype.styleNode=!1,ze.prototype.toStyleNode=function(){if(this.styleNode)return this.styleNode;this.styleNode=document.createElement("style"),this.styleNode.type="text/css",this.url.replace(".ttf",".eot");var e="@font-face {\n";return e+="  font-family: '"+this.fontFamily+"';\n",e+="  src: url('"+this.url+"') format('"+this.format+"');\n",e+="}",this.styleNode.innerHTML=e,this.styleNode},ze.prototype.measureText=function(e,t){if(!this.loaded)return this.onerror("measureText() was called while the font was not yet loaded"),!1;this.context.font=t+"px '"+this.fontFamily+"'";var n=this.context.measureText(e);n.fontsize=t,n.ascent=0,n.descent=0,n.bounds={minx:0,maxx:n.width,miny:0,maxy:0},n.height=0;var i=[];n.width,this.metrics.quadsize,i.push(e);var r,o=i.length;for(r=0;r<o;r++)this.measureSegment(i[r],t,n);return n},ze.prototype.measureSegment=function(e,t,n){var i=document.createElement("div");for(i.style.position="absolute",i.style.opacity=0,i.style.font=t+"px '"+this.fontFamily+"'",i.innerHTML=e,g=1;g<10;g++)i.innerHTML+="<br/>"+e;document.body.appendChild(i),n.leading=1.2*t;var r,o=(r=i,"height",document.defaultView.getComputedStyle(r,null).getPropertyValue("height"));if((o=o.replace("px",""))>=10*t&&(n.leading=o/10|0),document.body.removeChild(i),/^\s*$/.test(e))return n;this.canvas;var s=this.context,a=this.systemfont?1e3:this.metrics.quadsize,l=a,c=a,u=a/2,f=(a-n.width)/2;f!==(0|f)&&(f|=0),s.fillStyle="white",s.fillRect(-50,-50,l+100,c+100),s.fillStyle="black",s.fillText(e,f,u);for(var h=n.width+50|0,p=4*t,y=f-25,d=u-p/2,v=s.getImageData(y,d,h,p).data,g=0,m=0,b=4*h,A=v.length,w=p/2;++g<A&&255===v[g];);var k=g/b|0;for(g=A-1;--g>0&&255===v[g];);var O=g/b|0;for(g=0,m=0;m<h&&255===v[g];)(g+=b)>=A&&(m++,g=g-A+4);var x=m,P=1;for(g=A-3,m=0;m<h&&255===v[g];)(g-=b)<0&&(m++,g=A-3-4*P++);var S=h-m;return n.ascent=w-k,n.descent=O-w,n.bounds={minx:x-25,maxx:S-25,miny:-n.descent,maxy:n.ascent},n.height=O-k+1,n},Object.defineProperty(ze.prototype,"src",{set:function(e){this.url=e,this.loadFont()}}),"undefined"!=typeof define?define((function(){return ze})):window.Font=ze;const Ie=ze;function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Fe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Le(){return Le="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Ne(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},Le.apply(this,arguments)}function Ne(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Be(e)););return e}function Me(e,t){return Me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Me(e,t)}function De(e,t){if(t&&("object"===je(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Be(e){return Be=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Be(e)}var Ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Me(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Be(i);if(r){var n=Be(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return De(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this)).timeStarted=0,e.percentageLoaded=0,e.incremental=0,e.imageAssets=[],e.totalImages=0,e.soundAssets=[],e.totalFonts=0,e.message=null,e}return t=s,(n=[{key:"initialize",value:function(){Le(Be(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){var e,t,n;for(Ve.logs.log("Preloader::activate","Loading assets"),Le(Be(s.prototype),"activate",this).call(this),this.timeStarted=(new Date).getTime(),e=0,t=this.imageAssets.length;e<t;e++)n=this.imageAssets[e],this.addImageToLoad(n);for(e=0,t=this.soundAssets.length;e<t;e++)n=this.soundAssets[e],this.addSoundToLoad(n);this.message=new ue(Ve.localization.get("loaded")+" "+this.percentageLoaded+"%",300,30),this.message.setPosition(Ve.core.size.x/2,Ve.core.size.y/2+100),this.message.setAlign(we.CENTER),this.message.setVerticalOffset(20),this.message.setFontColor("#FF2222"),this.gui.attachItem(this.message,"msg_loading")}},{key:"addAnimation",value:function(e){this.imageAssets.push(e)}},{key:"addSprite",value:function(e){e.xStart=0,e.yStart=0,e.frames=1,e.initFrame=0,e.speed=0,this.addAnimation(e)}},{key:"addImageToLoad",value:function(e){var t=null;Ve.sprites.imageExists(e.path)||(c("load",t=new Image,(function(){Ve.preloader.incrementalLoader()})),null!==Ve.options.assetsURLPrefix?t.src=Ve.options.assetsURLPrefix+e.path:t.src=u()+e.path,this.totalImages++,Ve.sprites.addImage(e.path,t)),Ve.sprites.spriteExists(e.name)||Ve.sprites.addSprite(e.name,e.path,e.xStart,e.yStart,e.width,e.height,e.frames,e.initFrame,e.speed)}},{key:"addSound",value:function(e){this.soundAssets.push(e)}},{key:"addSoundToLoad",value:function(e){var t=null;if(!Ve.sounds.soundExists(e.path)){var n=e.path;n=null!==Ve.options.assetsURLPrefix?Ve.options.assetsURLPrefix+n:u()+n,(t=new Audio(n)).load(),c("canplaythrough",t,(function(){Ve.preloader.incrementalLoader("sound")})),Ve.sounds.addSound(e.name,e.path,t)}}},{key:"addFont",value:function(e){var t=new Ie;this.totalFonts++,t.onerror=function(e){Ve.logs.log("Preloader::addFont","Error loading a font: "+e)},t.onload=function(){Ve.logs.log("Preloader::addFont","Font loaded <"+t.fontFamily+">"),Ve.preloader.incrementalLoader("font")},t.fontFamily=e.name,void 0!==e.flag?t.src=e.path:null!==Ve.options.assetsURLPrefix?t.src=Ve.options.assetsURLPrefix+e.path:t.src=u()+e.path,Ve.fonts.addFont(e.name,e.path,t)}},{key:"incrementalLoader",value:function(){var e=this.totalImages+this.soundAssets.length+this.totalFonts;this.incremental+=1,this.percentageLoaded=Math.floor(100*this.incremental/e)}},{key:"draw",value:function(e){Le(Be(s.prototype),"draw",this).call(this,e);var t=Ve.core.size.x/3;e.fillStyle="#FF2222",e.fillRect((Ve.core.size.x-t)/2+1,Ve.core.size.y/2+51,this.percentageLoaded*t/100,15),e.lineWidth=2,e.strokeStyle="#FFEEEE",e.strokeRect((Ve.core.size.x-t)/2,Ve.core.size.y/2+50,t+2,16)}},{key:"step",value:function(e){Le(Be(s.prototype),"step",this).call(this,e),this.message.setText(Ve.localization.get("loaded")+" "+this.percentageLoaded+"%");var t=(new Date).getTime()-this.timeStarted;this.percentageLoaded>=100&&t>1e3&&(Ve.core.activate(),Ve.external("LOADED",null,null))}}])&&Fe(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(Re);function Ge(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ue=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ve.logs.log("Player::initialize","Initializing player object"),this.avatar=null}var t,n;return t=e,(n=[{key:"getAvatar",value:function(){return this.avatar}},{key:"setAvatar",value:function(e){this.avatar=e}},{key:"initialize",value:function(){}},{key:"activate",value:function(){}},{key:"step",value:function(){}},{key:"draw",value:function(){}}])&&Ge(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function He(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const Ve=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=null,this.logs=null,this.core=null,this.device=null,this.effects=null,this.particles=null,this.sprites=null,this.sounds=null,this.fonts=null,this.clock=null,this.localization=null,this.input=null,this.controls=null,this.scenes=null,this.preloader=null,this.game=null,this.externalCallback=null,this.player=null}var t,n;return t=e,(n=[{key:"initialize",value:function(e,t,n){this.options=new s,this.logs=new qe,this.core=new m,this.device=new A,this.effects=new j,this.particles=new L,this.sprites=new M,this.sounds=new B,this.fonts=new G,this.clock=new W,this.localization=new Y,this.input=new h,this.scenes=new H,this.preloader=new Ke,this.player=new Ue,this.logs.log("Engine::initialize","Initializing starts..."),this.game=t,void 0!==n&&(this.externalCallback=n),this.core.initialize(e),this.device.initialize(),this.effects.initialize(),this.particles.initialize(),this.sprites.initialize(),this.sounds.initialize(),this.clock.initialize(),this.input.initialize(),this.localization.initialize(),this.scenes.initialize(),this.preloader.playable=!1,this.preloader.initialize(),this.game.initialize()}},{key:"external",value:function(e,t,n){var i=this;"undefined"!=typeof externalCallback&&setTimeout((function(){try{i.externalCallback(e,t,n)}catch(n){i.logs.log("Engine::external","Error with external callback with event "+e+" "+t)}}),1)}}])&&He(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}());function We(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var qe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"log",value:function(e,t,n){var i=[];if(!1!==Ve.options.debugInConsole)if(!0===Ve.options.debugFunctionNames&&i.push(e),Array.isArray(t)?i.push(t.join(" ")):i.push(t),n&&i.push(n),!0===Ve.options.debugInHtml&&void 0!==Ve.core.canvas){var r=document.createElement("div");r.innerHTML=i,Ve.core.canvas.parentNode.appendChild(r)}else void 0===window.console||void 0===window.console.log||window.console.log(i)}}])&&We(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ye(e,t){return void 0===t.x||void 0===t.y||void 0===e.x||void 0===e.y?-1:Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Qe(e){var t=new l;return t.x=Math.cos(e),t.y=Math.sin(e),t}function Xe(e){return Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xe(e)}function Ze(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Je(e,t){return Je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Je(e,t)}function $e(e,t){if(t&&("object"===Xe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function et(e){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},et(e)}var tt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Je(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=et(i);if(r){var n=et(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return $e(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this)).setPosition(e.x,e.y),n.setSpeed(t.x,t.y),n.ttl=-1,n.lived=0,n.color=[],n.size=2,n}return t=s,(n=[{key:"initialize",value:function(){}},{key:"activate",value:function(){}},{key:"step",value:function(e){this.move(this.speed.x*e/Ve.core.TIME_PER_FRAME,this.speed.y*e/Ve.core.TIME_PER_FRAME),this.lived++}},{key:"draw",value:function(){}},{key:"collide",value:function(){return!1}}])&&Ze(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(x);function nt(e){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nt(e)}function it(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function rt(){return rt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=ot(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},rt.apply(this,arguments)}function ot(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=lt(e)););return e}function st(e,t){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},st(e,t)}function at(e,t){if(t&&("object"===nt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function lt(e){return lt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},lt(e)}var ct=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&st(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=lt(i);if(r){var n=lt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return at(this,e)});function s(e,t,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this)).size=new l(10,10),i.particleSpeed=e,i.magnitude=t,i.particleColor=[255,255,255,255],i.particleLife=100,i.particleSize=3,i.started=!1,i.spread=n,i.emissionRate=3,i}return t=s,(n=[{key:"start",value:function(){this.started=!0}},{key:"stop",value:function(){this.started=!1}},{key:"createParticle",value:function(){var e=Math.random()*this.spread-this.spread/2,t=Qe(this.getRotation()+e);t=t.normalize();var n=new l(t.x*this.particleSpeed,t.y*this.particleSpeed),i=this.getPosition(),r=new tt(i,n);r.ttl=Math.random()*this.particleLife,r.color=this.particleColor,r.size=this.particleSize,Ve.particles.addParticle(r)}},{key:"step",value:function(e){if(rt(lt(s.prototype),"step",this).call(this,e),!0===this.started)for(var t=0;t<this.emissionRate;t++)this.createParticle()}},{key:"draw",value:function(e){rt(lt(s.prototype),"draw",this).call(this,e)}},{key:"collide",value:function(){return!1}}])&&it(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(x);function ut(e){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(e)}function ft(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ht(){return ht="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=pt(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},ht.apply(this,arguments)}function pt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=vt(e)););return e}function yt(e,t){return yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},yt(e,t)}function dt(e,t){if(t&&("object"===ut(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function vt(e){return vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},vt(e)}var gt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yt(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=vt(i);if(r){var n=vt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return dt(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this)).backgroundType="image",e.color="black",e.spriteName=null,e.position.x=Ve.core.size.x/2,e.position.y=Ve.core.size.y/2,e.pauseScroll=!1,e.verticalScroll=!1,e.verticalOffset=0,e.verticalSpeed=0,e.horizontalScroll=!1,e.horizontalOffset=0,e.horizontalSpeed=0,e}return t=s,(n=[{key:"initialize",value:function(){ht(vt(s.prototype),"initialize",this).call(this)}},{key:"activate",value:function(){ht(vt(s.prototype),"activate",this).call(this),this.verticalOffset=0,this.horizontalOffset=0}},{key:"step",value:function(e){ht(vt(s.prototype),"step",this).call(this,e),!1===this.pauseScroll&&(!0===this.verticalScroll?(this.verticalOffset+=this.verticalSpeed*e/Ve.core.TIME_PER_FRAME,this.verticalOffset=Math.floor(this.verticalOffset%Ve.core.size.y)):!0===this.horizontalScroll&&(this.horizontalOffset+=this.horizontalSpeed*e/Ve.core.TIME_PER_FRAME,this.horizontalOffset=Math.floor(this.horizontalOffset%Ve.core.size.x)))}},{key:"draw",value:function(e){if("color"==this.backgroundType)e.fillStyle=this.color,e.fillRect(0,0,Ve.core.size.x,Ve.core.size.y);else if("image"==this.backgroundType){var t,n;!0===this.verticalScroll?(t=Math.floor(this.verticalOffset),n=Ve.core.size.y-t,t>0&&e.drawImage(Ve.sprites.getImage(this.spriteName),0,n,Ve.core.size.x,t,0,0,Ve.core.size.x,t),n>0&&e.drawImage(Ve.sprites.getImage(this.spriteName),0,0,Ve.core.size.x,n,0,t,Ve.core.size.x,n)):!0===this.horizontalScroll?(t=Math.floor(this.horizontalOffset),n=Ve.core.size.x-t,t>0&&e.drawImage(Ve.sprites.getImage(this.spriteName),0,0,t,Ve.core.size.y,n,0,t,Ve.core.size.y),n>0&&e.drawImage(Ve.sprites.getImage(this.spriteName),t,0,n,Ve.core.size.y,0,0,n,Ve.core.size.y)):Ve.sprites.draw(e,this)}}}])&&ft(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(x);function mt(e,t,n){return"complete"===document.readyState?Ve.initialize(e,t,n):c("load",window,(function(){Ve.initialize(e,t,n)})),Ve}return t})()));